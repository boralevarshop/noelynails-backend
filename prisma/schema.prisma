// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN_GLOBAL
  DONO_SALAO
  PROFISSIONAL
  CLIENTE
}

enum StatusAgendamento {
  PENDENTE
  CONFIRMADO
  CANCELADO
  CONCLUIDO
}

enum Segmento {
  SALAO_BELEZA
  BARBEARIA
  CLINICA
  ESTETICA
  PETSHOP
  ESTUDIO_TATTOO
  SERVICOS_GERAIS
}

// SALÕES (TENANTS)
model Tenant {
  id               String    @id @default(uuid())
  nome             String
  slug             String    @unique
  telefone         String?
  logoUrl          String?
  
  corPrimaria      String    @default("#4F46E5")
  corSecundaria    String    @default("#F3F4F6")
  corTerciaria     String    @default("#FFFFFF")
  corTexto         String    @default("#FFFFFF")
  
  segmento         Segmento  @default(SALAO_BELEZA) 
  agendamentoOnline Boolean  @default(true) 

  plano            String    @default("FREE")     
  asaasCustomerId  String?   
  statusAssinatura String    @default("ACTIVE")   
  trialFim         DateTime? 
  whatsappInstance String?   
  ativo            Boolean   @default(true)

  createdAt        DateTime  @default(now())
  // ALTERADO PARA NÃO DAR ERRO
  updatedAt        DateTime  @default(now()) @updatedAt 

  usuarios         Usuario[]
  servicos         Servico[]
  agendamentos     Agendamento[]
  clientes         Cliente[]
  bloqueios        Bloqueio[]

  @@map("tenants")
}

// USUÁRIOS
model Usuario {
  id          String   @id @default(uuid())
  tenantId    String
  tenant      Tenant   @relation(fields: [tenantId], references: [id])
  
  nome        String
  email       String   @unique
  senha       String
  role        Role     @default(PROFISSIONAL)
  telefone    String?
  
  bio         String?
  instagram   String?
  avatarUrl   String?
  aparecerNoSite Boolean @default(true) 
  
  horarios    Json?    
  
  agendamentos      Agendamento[] 
  bloqueios         Bloqueio[]
  servicosQueAtende Servico[] 
  
  servicosCriados    Servico[] @relation("CriadorServico")
  servicosAtualizados Servico[] @relation("AtualizadorServico")

  createdAt   DateTime @default(now())
  // ALTERADO PARA NÃO DAR ERRO
  updatedAt   DateTime @default(now()) @updatedAt 

  @@map("usuarios")
}

// SERVIÇOS
model Servico {
  id          String   @id @default(uuid())
  tenantId    String
  tenant      Tenant   @relation(fields: [tenantId], references: [id])
  
  nome        String
  descricao   String?
  preco       Decimal  @db.Decimal(10, 2)
  duracaoMin  Int
  diasRetorno Int      @default(30) 
  
  ativo       Boolean  @default(true)

  createdById  String?
  createdBy    Usuario? @relation("CriadorServico", fields: [createdById], references: [id])
  
  updatedById  String?
  updatedBy    Usuario? @relation("AtualizadorServico", fields: [updatedById], references: [id])

  agendamentos Agendamento[]
  profissionais Usuario[] 

  createdAt    DateTime @default(now())
  // ALTERADO PARA NÃO DAR ERRO
  updatedAt    DateTime @default(now()) @updatedAt 

  @@map("servicos")
}

// CLIENTES
model Cliente {
  id          String   @id @default(uuid())
  tenantId    String
  tenant      Tenant   @relation(fields: [tenantId], references: [id])
  nome        String
  telefone    String   
  email       String?
  agendamentos Agendamento[]
  
  createdAt   DateTime @default(now())
  // ALTERADO PARA NÃO DAR ERRO
  updatedAt   DateTime @default(now()) @updatedAt 

  @@unique([tenantId, telefone])
  @@map("clientes")
}

// AGENDAMENTOS
model Agendamento {
  id             String            @id @default(uuid())
  tenantId       String
  tenant         Tenant            @relation(fields: [tenantId], references: [id])
  clienteId      String
  cliente        Cliente           @relation(fields: [clienteId], references: [id])
  profissionalId String
  profissional   Usuario           @relation(fields: [profissionalId], references: [id])
  servicoId      String
  servico        Servico           @relation(fields: [servicoId], references: [id])
  
  dataHora       DateTime 
  dataFim        DateTime 
  status         StatusAgendamento @default(PENDENTE)
  observacoes    String?
  canceladoPor   String?
  lembreteEnviado Boolean          @default(false)
  
  createdAt      DateTime          @default(now())
  // ALTERADO PARA NÃO DAR ERRO
  updatedAt      DateTime          @default(now()) @updatedAt 

  @@index([tenantId, dataHora])
  @@map("agendamentos")
}

// BLOQUEIOS
model Bloqueio {
  id             String   @id @default(uuid())
  tenantId       String
  tenant         Tenant   @relation(fields: [tenantId], references: [id])
  profissionalId String
  profissional   Usuario  @relation(fields: [profissionalId], references: [id])
  inicio         DateTime
  fim            DateTime
  motivo         String? 
  createdAt      DateTime @default(now())
  @@map("bloqueios")
}